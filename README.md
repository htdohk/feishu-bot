# 飞书AI聊天机器人产品文档
## ✨ 项目概述
本项目是一个基于飞书开放平台的机器人应用，集成了大语言模型（LLM）和多种功能模块。它主要通过飞书API与用户进行交互，并利用LLM实现智能对话。

### 部署效果
![feishu-bot](https://github.com/user-attachments/assets/239f3ec8-7381-42a8-b7ec-7ce766e90c12)

## 📖 主要功能
### 获取飞书消息
1. 获取单聊和群聊消息，按照不同的聊天群组存储聊天记录，等待使用。
1. 能够解析@机器人、引用、图片消息、链接消息等内容。

### 输出内容
1. 文本聊天
1. 图片生成
1. 文本以PlainTxt方式输出，不支持Markdown等富文本格式。
1. 图片生成每次1张，若输入参考图则选取最接近参考图比例的比例输出，单边像素不超过1024。
1. 当用户需要助手产出周报/月报时，分析该用户在群内的历史发布内容，形成简约的文字报告。
1. 当有新成员加入群聊时进行欢迎。

### 用户聊天意图解析
1. 一切针对聊天内容的响应皆基于语意理解，而非关键词命令。
1. 聊天中@机器人，则立刻回答指定问题。
1. 在@后的一段时间里分析用户语意，如果在相同的上下文内则持续回答用户问题，无需每次都@机器人。
1. 在群中旁听其它消息，分析上下文环境，在出现意见分歧、不确定性较高等可能需要机器人主动参与话题时，主动回复。
1. 当用户发送一张图片并且@机器人进行聊天时，需要调用多模态能力解析图片内容，并回答聊天意图。
1. 当用户发送一张图片并且@机器人，并且附带的语意是需要机器人生成新图时，需要将这张图片作为参考图进行生图。
1. 当用户发送网址时，调用模型自身的联网能力对网页内容进行解析。

### 实时参数调整
1. 在项目中以单独的文件统一管理所有的系统提示词。
1. 项目定义机器人基础性格（系统提示词）：
> 你叫托兰，是群聊助手，同时也是群里的一员，说话要有人味。不要自夸/推销/寒暄，说话言简意赅不要啰嗦，不要装腔作势。平铺直叙的输出，而不是markdown格式。可以适当的、克制的使用Emoji来丰富个性。
1. 根据不同的群聊，接受群内成员发出的性格更改指令，比如“俏皮一些”、“严谨一些”，“每次多说点”、“每次少说点”。
1. 根据不同的群聊，接受群内成员发出的主动性更改指令，比如“多发表些观点”、“少说话”。
1. 以上实时调整仅为举例而非关键词，需要提取用户语意。

### 调整命令
除了语意发起的参数调整，也支持命令调整：
> /help                     # 查看所有命令信息
> /summary weekly           # 生成周报
> /summary monthly          # 生成月报
> /set threshold 0.5        # 设置主动发言阈值（0-1），默认0.5
> /help                     # 查看所有命令信息

## 🏗️ 项目构成
### 部署架构
1. 终端一般是Linux主机，1Panel面板管理，以Docker化运行所有程序。
1. 针对不同的部署，以环境文件的方式存储部署相关变量。
1. 聊天和绘图可以调用不同的模型。

### 工具选择
1. 以Python为主要语言。
1. 使用PostgreSQL数据库，PgVector镜像以支持向量存储。

### 创建飞书应用
1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 创建企业自建应用
3. 获取以下信息：
   - App ID
   - App Secret
   - Verification Token
4. 配置应用权限：
   - `im:message` - 获取与发送单聊、群组消息
   - `im:message:readonly` - 读取消息
   - `im:chat` - 获取群组信息
5. 配置事件订阅：
   - 订阅 `im.message.receive_v1` 事件
   - 设置请求地址：`https://your-domain.com/feishu/events`

## 📄 许可证
本项目采用 MIT 许可证 - 详见`LICENSE`文件

## ⚠️ 免责声明
本项目仅供学习和研究使用。使用本项目时，请遵守相关法律法规和飞书开放平台的使用条款。对于使用本项目造成的任何直接或间接损失，开发者不承担任何责任。

---
